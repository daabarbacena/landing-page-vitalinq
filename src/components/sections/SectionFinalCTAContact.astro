---
import { MEDICAMENTOS_TRIAGEM_OPTIONS } from "../../types/triagem";

const medicamentosTriagem = MEDICAMENTOS_TRIAGEM_OPTIONS
  .filter((opt) => opt.active !== false)
  .sort((a, b) => (a.order ?? 0) - (b.order ?? 0));

const whatsappNumber = "13024657818";

const contacts = [
  {
    icon: "üí¨",
    title: "WhatsApp",
    description: "Atendimento r√°pido e direto",
    value: "+1 (302) 465-7818",
    buttonText: "Enviar mensagem",
    link: `https://wa.me/${whatsappNumber}`,
    ariaLabel: "Enviar mensagem no WhatsApp",
    isPrimary: true,
  },
  {
    icon: "üìû",
    title: "Telefone",
    description: "Ligue para nossa central",
    value: "+1 (302) 465-7818",
    buttonText: "Ligar agora",
    link: "tel:+13024657818",
    ariaLabel: "Ligar para o telefone",
  },
  {
    icon: "üìß",
    title: "E-mail",
    description: "Demandas institucionais e or√ßamentos",
    value: "contact@thevitalinq.com",
    buttonText: "Enviar e-mail",
    link: "mailto:contact@thevitalinq.com",
    ariaLabel: "Enviar e-mail",
  },
];

const hours = [
  {
    title: "Hor√°rios de atendimento",
    items: ["Segunda a s√°bado: 08h √†s 19h", "Domingo: emerg√™ncias"],
  },
  {
    title: "Localiza√ß√£o",
    items: ["S√£o Paulo ‚Äî SP", "Atendimento nacional"],
  },
];
---

<section
  id="contato"
  aria-labelledby="contact-heading"
  class="bg-white py-16 sm:py-20 lg:py-28"
>
  <!-- Card principal escuro -->
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="relative overflow-hidden rounded-3xl border border-[#673de6]/20 bg-[#191919] px-6 py-16 sm:px-8 sm:py-20 lg:px-12 lg:py-24">
      <!-- Glow decorativo roxo -->
      <div
        class="pointer-events-none absolute -right-96 top-0 h-96 w-96 rounded-full bg-[#673de6]/10 blur-3xl"
        aria-hidden="true"
      ></div>

      <div class="relative z-10">
        <!-- Cabe√ßalho do card -->
        <div class="text-center">
          <h2
            id="contact-heading"
            class="text-3xl font-bold leading-tight tracking-tight text-white sm:text-4xl lg:text-5xl"
          >
            Pronto para iniciar com seguran√ßa?
          </h2>
          <p class="mt-6 text-lg text-[#fff9] leading-relaxed max-w-3xl mx-auto">
            Envie sua receita ou descreva sua necessidade. N√≥s orientamos sobre viabilidade, documenta√ß√£o e pr√≥ximos passos ‚Äî de forma clara e humana.
          </p>
        </div>

        <!-- Callout cl√≠nico -->
        <div class="mt-8 mx-auto max-w-2xl rounded-xl border border-[#673de6]/30 bg-[#673de6]/10 p-6 sm:p-8 backdrop-blur-sm">
          <p class="text-base sm:text-lg font-semibold text-white italic text-center">
            Voc√™ n√£o precisa entender a burocracia. N√≥s explicamos e conduzimos com voc√™.
          </p>
        </div>

        <!-- Seletor de medicamento + CTA WhatsApp -->
        <div class="mt-12 mx-auto max-w-xl">
          <h3 class="text-xl font-semibold text-white text-center">
            Para orientar melhor, selecione o tipo de medicamento
          </h3>
          <p class="mt-3 text-sm text-[#fff9] leading-relaxed text-center">
            Isso ajuda nossa equipe a entender seu caso e indicar o caminho mais adequado. Voc√™ pode alterar depois.
          </p>

          <div class="mt-6">
            <label for="contato-medicamentos-select" class="block text-sm font-medium text-white">
              Tipo de medicamento
            </label>

            <select
              id="contato-medicamentos-select"
              name="medicamentos-contato"
              class="mt-3 block w-full rounded-lg border border-[#673de6]/50 bg-[#191919] px-4 py-3 text-base text-white placeholder-[#fff9] shadow-sm ring-1 ring-[#673de6]/20 focus:border-[#673de6] focus:ring-2 focus:ring-[#673de6]/40 transition-all"
            >
              <option value="" disabled selected>
                Selecione uma op√ß√£o
              </option>
              {medicamentosTriagem.map((opt) => (
                <option value={opt.value}>{opt.label}</option>
              ))}
            </select>

            <p class="mt-2 text-xs text-[#fff9]">
              As op√ß√µes s√£o atualizadas pela nossa equipe em tempo real, conforme disponibilidade e regulamenta√ß√£o.
            </p>
          </div>

          <!-- Bot√£o CTA WhatsApp -->
          <a
            id="contato-whatsapp-cta"
            href={`https://wa.me/${whatsappNumber}`}
            target="_blank"
            rel="noopener noreferrer"
            class="mt-6 block rounded-lg bg-[#673de6] px-8 py-4 text-center text-base font-semibold text-white shadow-lg transition-all hover:shadow-[0_0_32px_rgba(112,71,235,0.4)] active:scale-95"
          >
            üöÄ Iniciar importa√ß√£o agora
          </a>

          <!-- Badge de urg√™ncia -->
          <p class="mt-4 text-sm text-[#fff9] text-center">
            ‚è±Ô∏è Resposta garantida em at√© 24h
          </p>
        </div>

        <!-- Grid de contatos -->
        <div class="mt-12 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 lg:mt-16">
          {
            contacts.map((contact) => (
              <div
                class={`group rounded-2xl border p-6 sm:p-8 transition-all duration-200 ${
                  contact.isPrimary
                    ? "border-[#673de6]/50 bg-[#673de6]/15 hover:border-[#673de6]/80 hover:bg-[#673de6]/25"
                    : "border-white/10 bg-white/5 hover:border-[#673de6]/50 hover:bg-white/10"
                }`}
              >
                {/* Marcador */}
                <div class="mb-4 flex h-12 w-12 items-center justify-center rounded-lg bg-[#673de6]/20 group-hover:bg-[#673de6]/30 transition-colors text-2xl">
                  {contact.icon}
                </div>

                {/* Conte√∫do */}
                <h3 class="text-lg font-semibold text-white group-hover:text-[#673de6] transition-colors">
                  {contact.title}
                </h3>
                <p class="mt-2 text-sm text-[#fff9]">{contact.description}</p>

                {/* Valor de contato */}
                <p class="mt-4 text-base font-semibold text-[#673de6]">
                  {contact.value}
                </p>

                {/* Bot√£o */}
                <a
                  href={contact.link}
                  aria-label={contact.ariaLabel}
                  class={`mt-6 inline-block rounded-lg px-5 py-2 text-sm font-semibold transition-all focus:outline-none focus:ring-2 focus:ring-[#673de6] focus:ring-offset-2 focus:ring-offset-[#191919] ${
                    contact.isPrimary
                      ? "bg-[#673de6] text-white hover:shadow-[0_0_32px_rgba(112,71,235,0.5)]"
                      : "border border-[#673de6] text-[#673de6] hover:bg-[#673de6]/20"
                  }`}
                >
                  {contact.buttonText}
                </a>
              </div>
            ))
          }
        </div>

        <!-- Grid auxiliar: Hor√°rios + Localiza√ß√£o -->
        <div class="mt-12 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:mt-16">
          {
            hours.map((section) => (
              <div class="rounded-xl border border-white/10 bg-white/5 p-6 sm:p-8">
                <h3 class="text-lg font-semibold text-white">{section.title}</h3>
                <ul class="mt-4 space-y-2">
                  {section.items.map((item) => (
                    <li class="text-sm text-[#fff9] flex items-start gap-2">
                      <span class="flex-shrink-0 text-[#673de6]">‚Ä¢</span>
                      <span>{item}</span>
                    </li>
                  ))}
                </ul>
              </div>
            ))
          }
        </div>

        <!-- Microcopy de privacidade -->
        <div class="mt-12 text-center">
          <p class="text-xs sm:text-sm text-neutral-400 italic">
            Compartilhe apenas o necess√°rio. Tratamos suas informa√ß√µes com responsabilidade.
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  #contato-medicamentos-select option {
    background-color: #191919;
    color: white;
  }

  #contato-medicamentos-select option:checked {
    background: linear-gradient(#673de6, #673de6);
    background-color: #673de6;
    color: white;
  }
</style>

<script>
  const WHATSAPP_NUMBER = "13024657818";
  const BASE_URL = `https://wa.me/${WHATSAPP_NUMBER}`;

  function buildWhatsAppUrl(selectedLabel: string | null): string {
    if (selectedLabel) {
      const message = encodeURIComponent(
        `Ol√° vim pela landing page, gostaria de saber mais informa√ß√µes sobre o produto: ${selectedLabel}`
      );
      return `${BASE_URL}?text=${message}`;
    }
    return BASE_URL;
  }

  // Contact section select + CTA
  const contatoSelect = document.getElementById("contato-medicamentos-select") as HTMLSelectElement;
  const contatoCta = document.getElementById("contato-whatsapp-cta") as HTMLAnchorElement;

  if (contatoSelect && contatoCta) {
    contatoSelect.addEventListener("change", () => {
      const selectedOption = contatoSelect.options[contatoSelect.selectedIndex];
      const label = selectedOption ? selectedOption.textContent : null;
      contatoCta.href = buildWhatsAppUrl(label);
    });
  }

  // Hero section select + CTA
  const heroSelect = document.getElementById("medicamentos-select") as HTMLSelectElement;
  const heroCta = document.getElementById("hero-whatsapp-cta") as HTMLAnchorElement;

  if (heroSelect && heroCta) {
    heroSelect.addEventListener("change", () => {
      const selectedOption = heroSelect.options[heroSelect.selectedIndex];
      const label = selectedOption ? selectedOption.textContent : null;
      heroCta.href = buildWhatsAppUrl(label);
    });
  }
</script>
