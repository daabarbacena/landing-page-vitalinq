---
import { MEDICAMENTOS_TRIAGEM_OPTIONS } from "../../types/triagem";

const medicamentosTriagem = MEDICAMENTOS_TRIAGEM_OPTIONS
  .filter((opt) => opt.active !== false)
  .sort((a, b) => (a.order ?? 0) - (b.order ?? 0));

const whatsappNumber = "13024657818";

const contacts = [
  {
    icon: "üí¨",
    title: "WhatsApp",
    value: "+1 (302) 465-7818",
    link: `https://wa.me/${whatsappNumber}`,
  },
  {
    icon: "üìß",
    title: "E-mail",
    value: "contact@thevitalinq.com",
    link: "mailto:contact@thevitalinq.com",
  },
];
---

<section
  id="contato"
  aria-labelledby="contact-heading"
  class="relative bg-[#0a0a0a] py-24 sm:py-32 lg:py-40"
>
  <!-- Minimal background -->
  <div class="absolute inset-0 pointer-events-none">
    <div 
      class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] rounded-full bg-[#673de6]/5 blur-[200px]"
      aria-hidden="true"
    ></div>
  </div>

  <div class="relative z-10 max-w-3xl mx-auto px-6">
    <!-- Header -->
    <div class="text-center mb-12">
      <h2
        id="contact-heading"
        class="text-3xl sm:text-4xl lg:text-5xl font-light tracking-tight text-white"
      >
        Pronto para iniciar?
      </h2>
      <p class="mt-4 text-white/40 font-light max-w-md mx-auto">
        Envie sua receita ou descreva sua necessidade. N√≥s orientamos sobre viabilidade e pr√≥ximos passos.
      </p>
    </div>

    <!-- Contact Card -->
    <div class="p-8 sm:p-10 rounded-3xl bg-white/5 border border-white/10">
      <!-- Select -->
      <div class="mb-8">
        <label for="contato-medicamentos-select" class="block text-sm text-white/60 mb-2">
          Tipo de medicamento
        </label>
        <select
          id="contato-medicamentos-select"
          class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3.5 text-white transition-all focus:border-[#673de6] focus:outline-none"
        >
          <option value="" disabled selected class="bg-[#0a0a0a]">Selecione uma op√ß√£o</option>
          {medicamentosTriagem.map((opt) => (
            <option value={opt.value} class="bg-[#0a0a0a]">{opt.label}</option>
          ))}
        </select>
      </div>

      <!-- Main CTA -->
      <a
        id="contato-whatsapp-cta"
        href={`https://wa.me/${whatsappNumber}`}
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center justify-center gap-3 w-full py-4 bg-[#673de6] text-white font-light rounded-full transition-all duration-300 hover:bg-[#5a32d4] hover:shadow-[0_0_30px_rgba(103,61,230,0.3)]"
      >
        <span>Iniciar importa√ß√£o agora</span>
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
        </svg>
      </a>

      <!-- Note -->
      <p class="mt-4 text-center text-white/30 text-sm">
        ‚è±Ô∏è Resposta garantida em at√© 24h
      </p>

      <!-- Contact options -->
      <div class="mt-8 pt-8 border-t border-white/10">
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          {contacts.map((contact) => (
            <a
              href={contact.link}
              class="flex items-center justify-center gap-2 px-4 py-2 text-white/60 hover:text-white text-sm transition-colors"
            >
              <span>{contact.icon}</span>
              <span>{contact.value}</span>
            </a>
          ))}
        </div>
      </div>
    </div>

    <!-- Hours -->
    <div class="mt-8 text-center text-white/30 text-sm">
      <p>Segunda a s√°bado: 08h √†s 19h</p>
    </div>
  </div>
</section>

<style>
  option {
    background-color: #0a0a0a;
    color: white;
  }

  @keyframes fade-in-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  section > div {
    animation: fade-in-up 0.8s ease-out forwards;
  }

  @media (prefers-reduced-motion: reduce) {
    section > div {
      animation: none;
    }
  }
</style>

<script>
  const WHATSAPP_NUMBER = "13024657818";
  const BASE_URL = `https://wa.me/${WHATSAPP_NUMBER}`;

  function buildWhatsAppUrl(selectedLabel: string | null): string {
    if (selectedLabel) {
      const message = encodeURIComponent(
        `Ol√° vim pela landing page, gostaria de saber mais informa√ß√µes sobre o produto: ${selectedLabel}`
      );
      return `${BASE_URL}?text=${message}`;
    }
    return BASE_URL;
  }

  const contatoSelect = document.getElementById("contato-medicamentos-select") as HTMLSelectElement;
  const contatoCta = document.getElementById("contato-whatsapp-cta") as HTMLAnchorElement;

  if (contatoSelect && contatoCta) {
    contatoSelect.addEventListener("change", () => {
      const selectedOption = contatoSelect.options[contatoSelect.selectedIndex];
      const label = selectedOption ? selectedOption.textContent : null;
      contatoCta.href = buildWhatsAppUrl(label);
    });
  }

  const heroSelect = document.getElementById("medicamentos-select") as HTMLSelectElement;
  const heroCta = document.getElementById("hero-whatsapp-cta") as HTMLAnchorElement;

  if (heroSelect && heroCta) {
    heroSelect.addEventListener("change", () => {
      const selectedOption = heroSelect.options[heroSelect.selectedIndex];
      const label = selectedOption ? selectedOption.textContent : null;
      heroCta.href = buildWhatsAppUrl(label);
    });
  }
</script>
