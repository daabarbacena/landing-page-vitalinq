---
import { MEDICAMENTOS_TRIAGEM_OPTIONS } from "../../types/triagem";

const medicamentosTriagem = MEDICAMENTOS_TRIAGEM_OPTIONS
  .filter((opt) => opt.active !== false)
  .sort((a, b) => (a.order ?? 0) - (b.order ?? 0));

const whatsappNumber = "13024657818";
---

<section
  id="contato"
  aria-labelledby="contact-heading"
  class="relative bg-white py-24 sm:py-32 lg:py-40 overflow-hidden"
>
  <!-- Background gradient accent -->
  <div class="absolute inset-0 pointer-events-none">
    <div
      class="absolute -right-1/4 top-0 w-[600px] h-[600px] rounded-full bg-[#673de6]/8 blur-[150px]"
      aria-hidden="true"
    ></div>
    <div
      class="absolute -left-1/4 bottom-0 w-[400px] h-[400px] rounded-full bg-[#673de6]/5 blur-[120px]"
      aria-hidden="true"
    ></div>
  </div>

  <div class="relative z-10 max-w-2xl mx-auto px-6">
    <!-- Header -->
    <div class="text-center mb-12">
      <h2
        id="contact-heading"
        class="text-3xl sm:text-4xl lg:text-5xl font-light tracking-tight text-gray-900"
      >
        Pronto para <span class="font-normal text-[#673de6]">iniciar?</span>
      </h2>
      <p class="mt-4 text-gray-600 font-light">
        Envie sua receita ou descreva sua necessidade.
      </p>
    </div>

    <!-- Contact Card -->
    <div class="p-8 sm:p-10 rounded-3xl bg-[#f8f7f5] border border-gray-200">
      <!-- Select -->
      <div class="mb-8">
        <label for="contato-medicamentos-select" class="block text-sm text-gray-700 mb-2 font-light">
          Tipo de medicamento
        </label>
        <select
          id="contato-medicamentos-select"
          class="w-full bg-white border border-gray-300 rounded-xl px-4 py-3.5 text-gray-900 transition-all focus:border-[#673de6] focus:outline-none focus:ring-2 focus:ring-[#673de6]/20"
        >
          <option value="" disabled selected class="bg-white">Selecione uma opção</option>
          {medicamentosTriagem.map((opt) => (
            <option value={opt.value} class="bg-white">{opt.label}</option>
          ))}
        </select>
      </div>

      <!-- Main CTA -->
      <a
        id="contato-whatsapp-cta"
        href={`https://wa.me/${whatsappNumber}`}
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center justify-center gap-2 w-full py-4 bg-[#673de6] text-white text-sm font-medium rounded-full transition-all duration-300 hover:bg-[#5a32d4] hover:shadow-lg"
      >
        Iniciar importação
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </a>

      <!-- Contact info -->
      <div class="mt-8 pt-6 border-t border-gray-300 flex flex-col sm:flex-row gap-4 justify-center text-sm text-gray-600">
        <a href={`https://wa.me/${whatsappNumber}`} class="hover:text-[#673de6] transition-colors text-center">
          +1 (302) 465-7818
        </a>
        <span class="hidden sm:inline text-gray-400">|</span>
        <a href="mailto:contact@thevitalinq.com" class="hover:text-[#673de6] transition-colors text-center">
          contact@thevitalinq.com
        </a>
      </div>
    </div>

    <!-- Hours -->
    <p class="mt-8 text-center text-gray-500 text-xs font-light">
      Seg–Sáb 08h–19h · Resposta em até 24h
    </p>
  </div>
</section>

<style>
  option {
    background-color: white;
    color: #111827;
  }
</style>

<script>
  const WHATSAPP_NUMBER = "13024657818";
  const BASE_URL = `https://wa.me/${WHATSAPP_NUMBER}`;

  function buildWhatsAppUrl(selectedLabel: string | null): string {
    if (selectedLabel) {
      const message = encodeURIComponent(
        `Olá vim pela landing page, gostaria de saber mais informações sobre o produto: ${selectedLabel}`
      );
      return `${BASE_URL}?text=${message}`;
    }
    return BASE_URL;
  }

  const contatoSelect = document.getElementById("contato-medicamentos-select") as HTMLSelectElement;
  const contatoCta = document.getElementById("contato-whatsapp-cta") as HTMLAnchorElement;

  if (contatoSelect && contatoCta) {
    contatoSelect.addEventListener("change", () => {
      const selectedOption = contatoSelect.options[contatoSelect.selectedIndex];
      const label = selectedOption ? selectedOption.textContent : null;
      contatoCta.href = buildWhatsAppUrl(label);
    });
  }
</script>
